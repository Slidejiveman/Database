/* Database Systems, Coronel/Morris */
/* Type of SQL : SQL Server*/

DROP TABLE CUSTOMER;
DROP TABLE CUSTOMER_2;
DROP TABLE INVOICE;

CREATE TABLE CUSTOMER (
CUST_NUM INT PRIMARY KEY,
CUST_LNAME VARCHAR(20),
CUST_FNAME VARCHAR(20),
CUST_BALANCE FLOAT(8)
);

CREATE TABLE CUSTOMER_2 (
CUST_NUM INT PRIMARY KEY,
CUST_LNAME VARCHAR(20),
CUST_FNAME VARCHAR(20)
);

CREATE TABLE INVOICE (
INV_NUM INT PRIMARY KEY,
CUST_NUM INT, 
INV_DATE DATE,
INV_AMOUNT FLOAT(8)
);

INSERT INTO CUSTOMER VALUES(1000 ,'Smith'  ,'Jeanne' ,1050.11);
INSERT INTO CUSTOMER VALUES(1001 ,'Ortega' ,'Juan'   ,840.92);

INSERT INTO CUSTOMER_2 VALUES(2000 ,'McPherson' ,'Anne');
INSERT INTO CUSTOMER_2 VALUES(2001 ,'Ortega'    ,'Juan');
INSERT INTO CUSTOMER_2 VALUES(2002 ,'Kowalski'  ,'Jan');
INSERT INTO CUSTOMER_2 VALUES(2003 ,'Chen'      ,'George');

INSERT INTO INVOICE VALUES(8000 ,1000 ,'23-MAR-2016' ,235.89);
INSERT INTO INVOICE VALUES(8001 ,1001 ,'23-MAR-2016' ,312.82);
INSERT INTO INVOICE VALUES(8002 ,1001 ,'30-MAR-2016' ,528.1);
INSERT INTO INVOICE VALUES(8003 ,1000 ,'12-APR-2016' ,194.78);
INSERT INTO INVOICE VALUES(8004 ,1000 ,'23-APR-2016' ,619.44);

ALTER TABLE CUSTOMER
    ADD CUST_DOB DATE,
        CUST_AGE INT;

UPDATE CUSTOMER
SET    CUST_DOB = CASE 
                  WHEN CUST_NUM = 1000 THEN '1979-03-15'
                  WHEN CUST_NUM = 1001 THEN '1988-12-22'
				  ELSE CUST_DOB
				  END
UPDATE CUSTOMER
SET    CUST_AGE = CASE
                  WHEN CUST_NUM = 1000 THEN (SELECT DATEDIFF(YY, CUST_DOB, GETDATE()) FROM CUSTOMER WHERE CUST_NUM = 1000)
				  WHEN CUST_NUM = 1001 THEN (SELECT DATEDIFF(YY, CUST_DOB, GETDATE()) FROM CUSTOMER WHERE CUST_NUM = 1001)
				  ELSE CUST_AGE
				  END;
